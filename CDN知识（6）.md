## 阿里云CDN节点架构

## 阿里云CDN节点系统：内部架构图

### 关键组件：

1. LVS做四层负载均衡。
2. Tengine做七层负载均衡
3. 安全
4. 业务逻辑处理
5. Swift做HTTP缓存
6. 高性能cache
7. 磁盘（SSD/SATA）

## 四层负载均衡：LVS

1. 四层负载均衡由前端负载均衡器和后端服务器池组成，一般一组服务器池对应一个应用。
2. 前端负载均衡器采用LVS+Keepalived的结构，用两台LVS机器互为备份（Master/Backup）的角色，Master和Backup之间通过VRRP协议自动切换从而实现Fail-Over。
3. 一切对后端服务器应用的访问都会通过LVS进入，LVS采用fullnat模式，将流量分担到服务器池中不同服务器进行处理，但处理完成后由相应服务器直接返回结果给客户端，从而提高了系统效率。
4. LVS是全球最流行的四层负载均衡开源软件，可以实现LINUX平台下的负载均衡。

## 七层负载均衡：Tengine

1. 七层服务均衡主要针对应用层服务提供负载均衡，例如HTTP服务等。
2. 对于HTTP服务而言，请求不仅仅通过LVS进行转发，而是在LVS和Web Server之间增加一层**HAProxy**转发服务。
3. HAProxy作为应用层的负载平衡服务，在收到LVS转发的连接后，对HTTP头进行分析，根据规则配置（域名）转发到相应的后端Web Server去。
4. 七层负载均衡出流量不同于四层直接从服务器出去，需要服务器转发流量到前端HAProxy，由HAProxy负责转发。

